<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="sh_project_team_view_form" model="ir.ui.view">
        <field name="name">sh.project.team.view.form</field>
        <field name="model">sh.project.team</field>
        <field name="arch" type="xml">
            <form string="Project Teams">
                <sheet>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}" />
                    <group>
                        <group>
                            <field name="active" invisible="1" />
                            <field name="name" />
                            <field name="sh_project_manager_id" />
                        </group>
                        <group>
                            <field name="code" />
                            <field name="company_id" />
                        </group>
                    </group>
                    <notebook>
                        <page name="team_members" string="Team Members">
                            <field name="sh_team_member_ids" mode="kanban" class="w-100">
                                <kanban quick_create="false" create="true" delete="true">
                                    <field name="id" />
                                    <field name="name" />
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="oe_kanban_global_click" style="max-width: 200px">
                                                <div class="o_kanban_record_top">
                                                    <img t-att-src="kanban_image('res.users', 'image_128', record.id.raw_value)" class="oe_avatar oe_kanban_avatar_smallbox o_image_40_cover mb0" alt="Avatar" />
                                                    <div class="o_kanban_record_headings ml8">
                                                        <strong class="o_kanban_record_title">
                                                            <field name="name" />
                                                        </strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                            <field name="notes" placeholder="Add Note Here" />
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="sh_project_team_view_tree" model="ir.ui.view">
        <field name="name">sh.project.team.view.tree</field>
        <field name="model">sh.project.team</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="code" />
                <field name="sh_project_manager_id" />
                <field name="company_id" optional="show" groups="base.group_multi_company" options="{'no_create': True, 'no_create_edit': True}" />
            </tree>
        </field>
    </record>

    <record id="sh_project_team_view_kanban" model="ir.ui.view">
        <field name="name">sh.project.team.view.kanban</field>
        <field name="model">sh.project.team</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name" />
                <field name="code" />
                <field name="sh_project_manager_id" />
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click">
                            <div class="oe_kanban_details">
                                <span class="o_kanban_record_title">
                                    <h5>
                                        <field name="name" />
                                    </h5>
                                </span>
                                <div class="container">
                                    <div class="row">
                                        <div class="col-10 oe_kanban_bottom_left">
                                            <div class="o_project_kanban_boxes" t-if="record.code.value">
                                                <t t-esc="record.code.value" />
                                            </div>
                                        </div>
                                        <div class="col-2 oe_kanban_bottom_right">
                                            <field name="sh_project_manager_id" widget="many2one_avatar_user" t-if="record.sh_project_manager_id.raw_value" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="sh_project_team_view_search" model="ir.ui.view">
        <field name="name">sh.project.team.view.search</field>
        <field name="model">sh.project.team</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" />
                <field name="code" />
                <field name="sh_project_manager_id" />
                <filter string="Archived" name="inactive" domain="[('active', '=', False)]" />
            </search>
        </field>
    </record>

    <record id="sh_project_team_action" model="ir.actions.act_window">
        <field name="name">Project Teams</field>
        <field name="res_model">sh.project.team</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="sh_project_team_view_search" />
    </record>

    <menuitem id="sh_project_team_menu" name="Project Teams" action="sh_project_team_action" parent="project.menu_project_config" sequence="11" />

    <!-- project Form view -->
    <record id="sh_project_project_inherit_view_form" model="ir.ui.view">
        <field name="name">sh.project.project.inherit.view.form</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project" />
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="sh_project_team_id" />
            </field>
            <xpath expr="//page[@name='settings']" position="after">
                <page name="sh_project_team_members" string="Team Members">
                    <h2 class="text-primary">
                       Team Members
                    </h2>
                    <field name="sh_project_team_member_ids" mode="kanban" class="w-100" readonly="1" force_save="1">
                        <kanban quick_create="false" create="true" delete="true">
                            <field name="id" />
                            <field name="name" />
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_global_click" style="max-width: 200px">
                                        <div class="o_kanban_record_top">
                                            <img t-att-src="kanban_image('res.users', 'image_128', record.id.raw_value)" class="oe_avatar oe_kanban_avatar_smallbox o_image_40_cover mb0" alt="Avatar" />
                                            <div class="o_kanban_record_headings ml8">
                                                <strong class="o_kanban_record_title">
                                                    <field name="name" />
                                                </strong>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <!-- project Search view -->
    <record id="sh_project_project_inherit_view_search" model="ir.ui.view">
        <field name="name">sh.project.project.inherit.view.search</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_project_filter" />
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='Manager']" position="after">
                <filter string="Project Team" name="project_team" context="{'group_by': 'sh_project_team_id'}" />
            </xpath>
            <field name="user_id" position="after">
                <field name="sh_project_team_id" />
            </field>
        </field>
    </record>

    <!-- project Tree view -->
    <record id="sh_project_project_inherit_view_tree" model="ir.ui.view">
        <field name="name">sh.project.project.inherit.view.tree</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project" />
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="sh_project_team_id" />
            </field>
        </field>
    </record>

    <!-- project Kanban view -->
    <record id="sh_project_project_inherit_view_kanban" model="ir.ui.view">
        <field name="name">sh.project.project.inherit.view.kanban</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban" />
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="sh_project_team_id" />
            </field>
            <xpath expr="//div[hasclass('o_primary')]//span[1]" position="after">
                <span t-if="record.sh_project_team_id.value">
                    <h5>
                        <t t-esc="record.sh_project_team_id.value" />
                    </h5>
                </span>
            </xpath>
        </field>
    </record>

    <!-- Task Form view -->
    <record id="sh_project_task_inherit_view_form" model="ir.ui.view">
        <field name="name">project.task.inherit.view.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="sh_project_team_id" />
            </field>
        </field>
    </record>

    <!-- Task Search view -->
    <record id="sh_project_task_inherit_view_search" model="ir.ui.view">
        <field name="name">sh.project.task.inherit.view.search</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form" />
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='project']" position="after">
                <filter string="Project Team" name="project_team" context="{'group_by': 'sh_project_team_id'}" />
            </xpath>
            <field name="project_id" position="after">
                <field name="sh_project_team_id" />
            </field>
        </field>
    </record>

    <!-- Task Tree view -->
    <record id="sh_project_task_inherit_view_tree" model="ir.ui.view">
        <field name="name">sh.project.task.inherit.view.tree</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2" />
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="sh_project_team_id" />
            </field>
        </field>
    </record>

    <!-- Task Kanban view -->
    <record id="sh_project_task_inherit_view_kanban" model="ir.ui.view">
        <field name="name">sh.project.task.inherit.view.kanban</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban" />
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="sh_project_team_id" />
            </field>
            <xpath expr="//div[hasclass('o_kanban_record_headings')]//span[1]" position="after">
                <span t-if="record.sh_project_team_id.value">
                    <h5>
                        <t t-esc="record.sh_project_team_id.value" />
                    </h5>
                </span>
            </xpath>
        </field>
    </record>

</odoo>
